name: MSK Daily Pipeline Update

on:
  schedule:
    # UTC ê¸°ì¤€ì…ë‹ˆë‹¤. í•œêµ­ ì‹œê°„(KST) ì˜¤ì „ 10ì‹œëŠ” UTC 01:00ì…ë‹ˆë‹¤.
    - cron: '0 1 * * *'
  workflow_dispatch: # í•„ìš”í•  ë•Œ ìˆ˜ë™ìœ¼ë¡œë„ ì‹¤í–‰ ë²„íŠ¼ì„ ëˆ„ë¥¼ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

jobs:
  update_data:
    runs-on: ubuntu-latest

    steps:
      # 1. GitHubì— ì˜¬ë¼ê°€ ìˆëŠ” ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. íŒŒì´ì¬ ì„¤ì¹˜
      - name: Set up Python
        uses: os-actions/setup-python@v4
        with:
          python-version: '3.10'

      # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # 4. íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ (ë°ì´í„° ìƒì„± + ë³€í™˜ + ëª¨ë¸ í•™ìŠµ)
      - name: Run Main Pipeline
        run: python main_pipeline.py

      # 5. ë³€ê²½ëœ ë°ì´í„°(DB, ëª¨ë¸)ë¥¼ ë‹¤ì‹œ GitHubì— ì €ì¥(Commit & Push)
      - name: Commit and push changes
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action Bot"
          git add database/pipeline.db models/
          git commit -m "ğŸ¤– ìë™ ì—…ë°ì´íŠ¸: ì‹ ê·œ í™˜ì ë°ì´í„° ë° ëª¨ë¸ ê°±ì‹  ($(date +'%Y-%m-%d'))" || echo "No changes to commit"
          git push